# APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶

ä¸€ä¸ªåŸºäºPythonçš„ç°ä»£åŒ–APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶ï¼Œæ”¯æŒYAMLé©±åŠ¨çš„æµ‹è¯•ç”¨ä¾‹ç®¡ç†ã€æ•°æ®é©±åŠ¨æµ‹è¯•ã€AllureæŠ¥å‘Šç”Ÿæˆç­‰åŠŸèƒ½ã€‚

## ğŸš€ æ ¸å¿ƒç‰¹æ€§

### ğŸ“‹ æµ‹è¯•ç®¡ç†
- **YAMLé©±åŠ¨**: ä½¿ç”¨YAMLæ–‡ä»¶å®šä¹‰æµ‹è¯•ç”¨ä¾‹ï¼Œæ”¯æŒå¤æ‚çš„æ•°æ®ç»“æ„å’Œå‚æ•°åŒ–
- **æ•°æ®é©±åŠ¨æµ‹è¯•(DDT)**: æ”¯æŒå‚æ•°åŒ–æµ‹è¯•ï¼Œä¸€æ¬¡ç¼–å†™å¤šåœºæ™¯æ‰§è¡Œ

### ğŸ”§ æµ‹è¯•æ‰§è¡Œ
- **å¤šæ–­è¨€æ”¯æŒ**: æ”¯æŒequalsã€containsã€greaterã€not_Noneç­‰å¤šç§æ–­è¨€æ–¹å¼
- **æ•°æ®æå–**: ä½¿ç”¨JSONPathä»å“åº”ä¸­æå–æ•°æ®ï¼Œæ”¯æŒæµ‹è¯•ç”¨ä¾‹é—´çš„æ•°æ®ä¼ é€’
- **æ•°æ®åº“éªŒè¯**: æ”¯æŒMySQLæ•°æ®åº“éªŒè¯ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **åŠ¨æ€å‚æ•°**: æ”¯æŒéšæœºæ•°æ®ç”Ÿæˆå’ŒåŠ¨æ€å‚æ•°æ›¿æ¢

### ğŸ“Š æŠ¥å‘Šä¸æ—¥å¿—
- **AllureæŠ¥å‘Š**: è‡ªåŠ¨ç”Ÿæˆç¾è§‚çš„Allureæµ‹è¯•æŠ¥å‘Š
- **è¯¦ç»†æ—¥å¿—**: æ”¯æŒå¤šçº§åˆ«æ—¥å¿—è®°å½•ï¼Œä¾¿äºè°ƒè¯•å’Œé—®é¢˜å®šä½
- **æ€§èƒ½ç›‘æ§**: è®°å½•æ¥å£å“åº”æ—¶é—´ï¼Œæ”¯æŒæ€§èƒ½æ–­è¨€

## ğŸ“ é¡¹ç›®ç»“æ„

```
api-auto-test/
â”œâ”€â”€ ğŸ“ data/                    # æµ‹è¯•ç”¨ä¾‹æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ ğŸ“ user/               # ç”¨æˆ·ç›¸å…³æµ‹è¯•ç”¨ä¾‹
â”‚   â”‚   â”œâ”€â”€ add.yaml           # ç”¨æˆ·æ³¨å†Œæµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ login.yaml         # ç”¨æˆ·ç™»å½•æµ‹è¯•
â”‚   â”‚   â”œâ”€â”€ update.yaml        # ç”¨æˆ·æ›´æ–°æµ‹è¯•
â”‚   â”‚   â””â”€â”€ delete.yaml        # ç”¨æˆ·åˆ é™¤æµ‹è¯•
â”‚   â””â”€â”€ ğŸ“ project/            # é¡¹ç›®ç›¸å…³æµ‹è¯•ç”¨ä¾‹
â”‚       â”œâ”€â”€ add.yaml           # é¡¹ç›®åˆ›å»ºæµ‹è¯•
â”‚       â””â”€â”€ delete.yaml        # é¡¹ç›®åˆ é™¤æµ‹è¯•
â”œâ”€â”€ ğŸ“ testcase/               # æµ‹è¯•æ‰§è¡Œæ–‡ä»¶
â”‚   â”œâ”€â”€ conftest.py           # pytesté…ç½®å’Œfixture
â”‚   â”œâ”€â”€ test_01user.py        # ç”¨æˆ·æ¥å£æµ‹è¯•
â”‚   â”œâ”€â”€ test_02project.py     # é¡¹ç›®æ¥å£æµ‹è¯•
â”‚   â””â”€â”€ test_03delete.py      # åˆ é™¤æ¥å£æµ‹è¯•
â”œâ”€â”€ ğŸ“ utils/                  # å·¥å…·ç±»
â”‚   â”œâ”€â”€ request_util.py       # HTTPè¯·æ±‚å·¥å…·
â”‚   â”œâ”€â”€ assert_util.py        # æ–­è¨€å·¥å…·
â”‚   â”œâ”€â”€ yaml_util.py          # YAMLæ–‡ä»¶æ“ä½œ
â”‚   â”œâ”€â”€ mysql_util.py         # æ•°æ®åº“æ“ä½œ
â”‚   â”œâ”€â”€ parameterize_util.py  # å‚æ•°åŒ–å·¥å…·
â”‚   â””â”€â”€ logger_util.py        # æ—¥å¿—å·¥å…·
â”œâ”€â”€ ğŸ“ debugTalk/             # è°ƒè¯•å·¥å…·
â”‚   â””â”€â”€ debug_talk.py         # è°ƒè¯•å‡½æ•°é›†åˆ
â”œâ”€â”€ ğŸ“ api-docs/             # APIæ–‡æ¡£
â”œâ”€â”€ ğŸ“ logs/                 # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ ğŸ“ reports/              # æµ‹è¯•æŠ¥å‘Š
â”œâ”€â”€ ğŸ“ temps/                # ä¸´æ—¶æ–‡ä»¶
â”œâ”€â”€ config.yaml              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ pytest.ini              # pytesté…ç½®
â”œâ”€â”€ run.py                   # æµ‹è¯•æ‰§è¡Œå…¥å£
â””â”€â”€ extract.yaml             # æ•°æ®æå–æ–‡ä»¶
```

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

- **Python 3.7+**: ä¸»è¦å¼€å‘è¯­è¨€
- **pytest**: æµ‹è¯•æ¡†æ¶
- **requests**: HTTPè¯·æ±‚åº“
- **PyYAML**: YAMLæ–‡ä»¶å¤„ç†
- **PyMySQL**: MySQLæ•°æ®åº“è¿æ¥
- **Allure**: æµ‹è¯•æŠ¥å‘Šç”Ÿæˆ
- **JSONPath**: æ•°æ®æå–

## ğŸ“¦ å®‰è£…ä¸é…ç½®

### ç¯å¢ƒè¦æ±‚
- Python 3.7+
- MySQL 5.7+ (å¯é€‰ï¼Œç”¨äºæ•°æ®åº“éªŒè¯)

### å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### é…ç½®æ–‡ä»¶
ç¼–è¾‘ `config.yaml` æ–‡ä»¶ï¼š

```yaml
base:
  url: http://localhost:80  # APIåŸºç¡€URL

log:
  log_name: logs_           # æ—¥å¿—æ–‡ä»¶åå‰ç¼€
  log_level: info           # æ—¥å¿—çº§åˆ«
  log_format: '[%(asctime)s] %(filename)s->%(funcName)s line:%(lineno)d [%(levelname)s] %(message)s'

db:                        # æ•°æ®åº“é…ç½®ï¼ˆå¯é€‰ï¼‰
  user: root
  host: 127.0.0.1
  password: your_password
  port: 3306
  db: your_database
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œæµ‹è¯•
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python run.py

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–‡ä»¶
pytest testcase/test_01user.py -v

# è¿è¡Œç‰¹å®šæµ‹è¯•æ–¹æ³•
pytest testcase/test_01user.py::TestUser::test_add -v
```

### 2. æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š
æµ‹è¯•å®Œæˆåï¼Œåœ¨ `reports/` ç›®å½•ä¸‹æŸ¥çœ‹AllureæŠ¥å‘Šï¼š
```bash
allure serve ./temps/
```

## ğŸ“ æµ‹è¯•ç”¨ä¾‹ç¼–å†™

### YAMLæµ‹è¯•ç”¨ä¾‹æ ¼å¼

```yaml
- feature: "$ddt{feature}"                    # æµ‹è¯•ç”¨ä¾‹åç§°
  base_url: "${read_config_yaml(base,url)}"   # åŸºç¡€URL
  request:                                    # è¯·æ±‚é…ç½®
    url: "/v1/user"                          # æ¥å£è·¯å¾„
    method: "post"                           # HTTPæ–¹æ³•
    headers:                                 # è¯·æ±‚å¤´
      Content-Type: "application/json"
    json:                                    # è¯·æ±‚ä½“
      username: "$ddt{username}"
      password: "$ddt{password}"
  extract:                                   # æ•°æ®æå–
    - id: "$..ID"                           # ä½¿ç”¨JSONPathæå–ID
    - token: "$..token"                     # æå–token
  validate:                                 # æ–­è¨€é…ç½®
    - equals: { code: "$ddt{code}" }        # ç›¸ç­‰æ–­è¨€
    - equals: { msg: "$ddt{msg}" }          # æ¶ˆæ¯æ–­è¨€
    - greater: { time: 2000 }               # æ€§èƒ½æ–­è¨€
    - not_None: { sql: "$ddt{check_sql}" }  # æ•°æ®åº“æ–­è¨€
  parameterize:                             # å‚æ•°åŒ–æ•°æ®
    - ["feature", "username", "password", "code", "msg", "check_sql"]
    - ["æ­£å¸¸ç™»å½•", "admin", "123456", 200, "success", "select * from users where username='admin'"]
    - ["å¯†ç é”™è¯¯", "admin", "wrong", 400, "å¯†ç é”™è¯¯", ""]
```

### æ”¯æŒçš„æ–­è¨€ç±»å‹

1. **equals**: ç›¸ç­‰æ–­è¨€
   ```yaml
   - equals: { code: 200, msg: "success" }
   ```

2. **contains**: åŒ…å«æ–­è¨€
   ```yaml
   - contains: { message: "ç™»å½•æˆåŠŸ" }
   ```

3. **greater**: å¤§äºæ–­è¨€ï¼ˆé€šå¸¸ç”¨äºæ€§èƒ½æµ‹è¯•ï¼‰
   ```yaml
   - greater: { time: 1000 }  # å“åº”æ—¶é—´å°äº1000ms
   ```

4. **not_None**: éç©ºæ–­è¨€ï¼ˆé€šå¸¸ç”¨äºæ•°æ®åº“éªŒè¯ï¼‰
   ```yaml
   - not_None: { sql: "select * from users where id = 1" }
   ```

### æ•°æ®æå–

ä½¿ç”¨JSONPathè¯­æ³•ä»å“åº”ä¸­æå–æ•°æ®ï¼š

```yaml
extract:
  - user_id: "$..id"           # æå–ç”¨æˆ·ID
  - token: "$..data.token"     # æå–åµŒå¥—çš„token
  - username: "$..username"    # æå–ç”¨æˆ·å
```

### åŠ¨æ€å‚æ•°

æ”¯æŒå¤šç§åŠ¨æ€å‚æ•°ç”Ÿæˆï¼š

```yaml
# éšæœºç”¨æˆ·å
username: "${get_random_username()}"

# éšæœºæ‰‹æœºå·
phone: "${get_random_phone()}"

# è¯»å–é…ç½®æ–‡ä»¶
base_url: "${read_config_yaml(base,url)}"

# è¯»å–æå–çš„æ•°æ®
user_id: "${read_extract_yaml(id)}"
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### æ•°æ®åº“éªŒè¯
æ¡†æ¶æ”¯æŒMySQLæ•°æ®åº“éªŒè¯ï¼Œç¡®ä¿APIæ“ä½œçš„æ•°æ®ä¸€è‡´æ€§ï¼š

```yaml
validate:
  - not_None: { sql: "select * from users where username = '${read_extract_yaml(username)}'" }
```

### æ€§èƒ½æµ‹è¯•
æ”¯æŒæ¥å£å“åº”æ—¶é—´æ–­è¨€ï¼š

```yaml
validate:
  - greater: { time: 2000 }  # å“åº”æ—¶é—´å¿…é¡»å°äº2000ms
```

### æ•°æ®ä¼ é€’
æ”¯æŒæµ‹è¯•ç”¨ä¾‹é—´çš„æ•°æ®ä¼ é€’ï¼š

```yaml
# åœ¨ç™»å½•ç”¨ä¾‹ä¸­æå–token
extract:
  - token: "$..token"

# åœ¨åç»­ç”¨ä¾‹ä¸­ä½¿ç”¨token
headers:
  Authorization: "${read_extract_yaml(token)}"
```

### éšæœºæ•°æ®ç”Ÿæˆ
å†…ç½®å¤šç§éšæœºæ•°æ®ç”Ÿæˆå‡½æ•°ï¼š

```python
# éšæœºç”¨æˆ·åï¼ˆ20ä½å­—æ¯æ•°å­—ç»„åˆï¼‰
"${get_random_username()}"

# éšæœºæ‰‹æœºå·ï¼ˆç¬¦åˆä¸­å›½æ‰‹æœºå·æ ¼å¼ï¼‰
"${get_random_phone()}"
```

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### AllureæŠ¥å‘Š
æ¡†æ¶è‡ªåŠ¨ç”ŸæˆAllureæµ‹è¯•æŠ¥å‘Šï¼ŒåŒ…å«ï¼š
- æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œç»“æœ
- æ¥å£å“åº”æ—¶é—´ç»Ÿè®¡
- å¤±è´¥ç”¨ä¾‹è¯¦ç»†ä¿¡æ¯
- æµ‹è¯•ç¯å¢ƒä¿¡æ¯

### æ—¥å¿—è®°å½•
æ”¯æŒå¤šçº§åˆ«æ—¥å¿—è®°å½•ï¼š
- **DEBUG**: è¯¦ç»†è°ƒè¯•ä¿¡æ¯
- **INFO**: ä¸€èˆ¬ä¿¡æ¯è®°å½•
- **WARNING**: è­¦å‘Šä¿¡æ¯
- **ERROR**: é”™è¯¯ä¿¡æ¯

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   - æ£€æŸ¥ `config.yaml` ä¸­çš„æ•°æ®åº“é…ç½®
   - ç¡®ä¿MySQLæœåŠ¡æ­£åœ¨è¿è¡Œ
   - éªŒè¯æ•°æ®åº“ç”¨æˆ·æƒé™

2. **æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œå¤±è´¥**
   - æ£€æŸ¥YAMLæ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®
   - éªŒè¯APIæ¥å£æ˜¯å¦å¯è®¿é—®
   - æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯


### è°ƒè¯•æŠ€å·§

1. **å¯ç”¨è¯¦ç»†æ—¥å¿—**
   ```yaml
   log:
     log_level: debug
   ```

2. **æŸ¥çœ‹æµ‹è¯•æŠ¥å‘Š**
   ```bash
   allure serve ./temps/
   ```

3. **æ£€æŸ¥æ•°æ®æå–**
   æŸ¥çœ‹ `extract.yaml` æ–‡ä»¶ç¡®è®¤æ•°æ®æ˜¯å¦æ­£ç¡®æå–

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿è´¡çŒ®ä»£ç å’Œå»ºè®®ï¼è¯·éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. Fork æœ¬ä»“åº“
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. åˆ›å»º Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·é€šè¿‡ä»¥ä¸‹æ–¹å¼è”ç³»ï¼š

- åˆ›å»º Issue
- å‘é€é‚®ä»¶
- æäº¤ Pull Request

---

**APIè‡ªåŠ¨åŒ–æµ‹è¯•æ¡†æ¶** - è®©APIæµ‹è¯•æ›´ç®€å•ã€æ›´é«˜æ•ˆï¼ ğŸš€